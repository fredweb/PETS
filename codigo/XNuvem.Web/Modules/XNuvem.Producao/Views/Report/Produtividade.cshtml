@model XNuvem.Producao.Models.ProdutividadeViewModel
@using XNuvem.Mvc.Html
@using XNuvem.Producao.Models

<section class="content-header">
    <h1>Relatório de produção</h1>
</section>

<section class="content">
    @using (Html.XNBeginForm("Produtividade", "Report", "XNuvem.Producao")) {
        @Html.AntiForgeryToken()
        <div class="row">
            <div class="col-sm-12 col-md-8 col-lg-6">
                <div class="box">
                    <div class="box-body">
                        <div class="row">
                            <div class="col-sm-6">
                                @Html.EditorFor(m => m.FromDate)
                            </div>
                            <div class="col-sm-6">
                                @Html.EditorFor(m => m.ToDate)
                            </div>
                        </div>
                        @Html.XNAjaxDropDownFor(m => m.MetaAbs, "MetaSelect2", "Report", "XNuvem.Producao")
                        @Html.XNAjaxDropDownFor(m => m.Turno, "TurnoSelect2", "Report", "XNuvem.Producao")
                    </div>
                    <div class="box-footer">
                        <button type="submit" class="btn btn-success" title="Executar">Executar</button>
                    </div>
                </div>
            </div>
        </div>
        if (Model != null && Model.Items != null) { 
        <div class="row">
            <div class="col-sm-12">
                <div class="box">
                    <div class="box-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Família</th>
                                    <th>Turno</th>
                                    <th>Grupo</th>                                    
                                    <th class="text-right">FD/CX</th>
                                    <th class="text-right">PCT/UN</th>
                                    <th class="text-right">KG</th>
                                    <th class="text-right">R$ Vendas</th>
                                    <th class="text-right">R$ Custo</th>
                                    <th class="text-right">% CPV</th>
                                    <th class="text-right">% Meta CPV</th>
                                    <th class="text-right">Var Meta CPV</th>
                                    <th class="text-right">Meta (PCT)</th>
                                    <th class="text-right">Var Meta(PCT)</th>
                                    <th class="text-right">% Meta (PCT)</th>
                                    <th class="text-right">Meta (R$)</th>
                                    <th class="text-right">Var Meta (R$)</th>
                                    <th class="text-right">% Meta (R$)</th>
                                </tr>
                            </thead>
                            <tbody>
                                @PrintGeral(Model)
                                @PrintLines(Model)
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
                }
    }
</section>

@helper PrintGeral(ProdutividadeViewModel item) {
    <tr>
        <td><strong>GERAL</strong></td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td class="text-right"><strong>@item.Geral.Quantity</strong></td>
        <td class="text-right"><strong>@item.Geral.TotalPacotes</strong></td>
        <td class="text-right"><strong>@item.Geral.TotalKilo</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.Geral.TotalVendas))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.Geral.TotalCost))</strong></td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
    </tr>
}

@helper PrintFamilia(ProdutividadeFamiliaItem item) {
    <tr>
        <td><strong>@item.Familia</strong></td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
        <td class="text-right"><strong>@item.Quantity</strong></td>
        <td class="text-right"><strong>@item.TotalPacotes</strong></td>
        <td class="text-right"><strong>@item.TotalKilo</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.TotalVendas))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.TotalCost))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:0.00}", item.PercCPV))</strong></td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right"><strong>@item.MetaPacotes</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:0.00}", item.VarMetaPCT))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:0.00}", item.PercMetaPCT))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.MetaVendas))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:C}", item.VarMetaVenda))</strong></td>
        <td class="text-right"><strong>@(string.Format("{0:0.00}", item.PercMetaVenda))</strong></td>
    </tr>
    foreach (var t in item.Items) {
        @PrintTurno(t)
    }
}

@helper PrintTurno(ProdutividadeTurnoItem item) {
    <tr>
        <td><strong>@item.Familia</strong></td>
        <td><strong>@item.Turno</strong></td>
        <td>&nbsp;</td>
        <td class="text-right">@item.Quantity</td>
        <td class="text-right">@item.TotalPacotes</td>
        <td class="text-right">@item.TotalKilo</td>
        <td class="text-right">@(string.Format("{0:C}", item.TotalVendas))</td>
        <td class="text-right">@(string.Format("{0:C}", item.TotalCost))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercCPV))</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">&nbsp;</td>
        <td class="text-right">@item.MetaPacotes</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.VarMetaPCT))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercMetaPCT))</td>
        <td class="text-right">@(string.Format("{0:C}", item.MetaVendas))</td>
        <td class="text-right">@(string.Format("{0:C}", item.VarMetaVenda))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercMetaVenda))</td>
    </tr>
    foreach (var i in item.Items) {
        @PrintItem(i)
    }
}

@helper PrintItem(ProdutividadeItemViewModel item) {
    <tr>
        <td>&nbsp;</td>
        <td>@item.Turno</td>
        <td>@item.Grupo</td>
        <td class="text-right">@item.Quantity</td>
        <td class="text-right">@item.TotalPacotes</td>
        <td class="text-right">@item.TotalKilo</td>
        <td class="text-right">@(string.Format("{0:C}", item.TotalVendas))</td>
        <td class="text-right">@(string.Format("{0:C}", item.TotalCost))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercCPV))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.MetaCPV))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.VarMetaCPV))</td>
        <td class="text-right">@item.MetaPacotes</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.VarMetaPCT))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercMetaPCT))</td>
        <td class="text-right">@(string.Format("{0:C}", item.MetaVendas))</td>
        <td class="text-right">@(string.Format("{0:C}", item.VarMetaVenda))</td>
        <td class="text-right">@(string.Format("{0:0.00}", item.PercMetaVenda))</td>
    </tr>
}

@helper PrintLines(ProdutividadeViewModel item) {
    foreach (var f in item.Familias) {
        @PrintFamilia(f)
    }
}